<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>LMod Workshop (Online)</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background-color: #111;
      color: #fff;
      margin: 0;
      padding: 0;
    }
    header {
      background: #222;
      padding: 20px;
      text-align: center;
    }
    header h1 {
      margin: 0;
      font-size: 36px;
    }
    #uploadForm {
      background: #1c1c1c;
      padding: 20px;
      text-align: center;
    }
    #uploadForm input, #uploadForm label {
      margin: 10px;
      display: block;
      font-size: 16px;
    }
    #uploadForm input[type="text"] {
      padding: 5px;
      width: 300px;
    }
    .workshop-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      padding: 20px;
      gap: 20px;
    }
    .mod-box {
      background: #222;
      border: 1px solid #444;
      border-radius: 10px;
      width: 400px;
      box-shadow: 0 0 10px #000;
      overflow: hidden;
    }
    .mod-image {
      width: 100%;
      height: 200px;
      background-size: cover;
      background-position: center;
      border-bottom: 1px solid #444;
    }
    .mod-info {
      padding: 15px;
    }
    .mod-title {
      font-size: 20px;
      margin-bottom: 5px;
    }
    .mod-author {
      font-size: 14px;
      color: #aaa;
      margin-bottom: 10px;
    }
    .subscribe-btn {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 5px;
      cursor: pointer;
    }
    .subscribe-btn:hover {
      background: #45a049;
    }
  </style>
</head>
<body>
<header>
  <h1>LMod Workshop</h1>
  <p>Upload and browse custom content for LMod</p>
</header>
<div id="uploadForm">
  <h2>Upload a Mod</h2>
  <label>Mod Name: <input type="text" id="modName"></label>
  <label>Author: <input type="text" id="modAuthor" value="LEMONTECH"></label>
  <label>.json File: <input type="file" id="modFile" accept=".json"></label>
  <label>Preview Image (.png): <input type="file" id="modImage" accept="image/png"></label>
  <button onclick="uploadMod()">Add to Workshop</button>
</div>
<div class="workshop-container" id="workshopList"></div>
<script>
const firebaseConfig = {
  apiKey: "TWÃ“J_KLUCZ",
  authDomain: "XXX.firebaseapp.com",
  projectId: "XXX",
  storageBucket: "XXX.appspot.com",
  messagingSenderId: "XXX",
  appId: "XXX"
};

firebase.initializeApp(firebaseConfig);
const storage = firebase.storage();
const db = firebase.firestore();

async function uploadMod() {
  const name = document.getElementById("modName").value.trim();
  const author = document.getElementById("modAuthor").value.trim();
  const jsonFile = document.getElementById("modFile").files[0];
  const imageFile = document.getElementById("modImage").files[0];

  if (!name || !author || !jsonFile || !imageFile) {
    alert("Fill in all fields.");
    return;
  }

  const imageRef = storage.ref("mods/" + Date.now() + "_" + imageFile.name);
  const jsonRef = storage.ref("mods/" + Date.now() + "_" + jsonFile.name);

  const imageSnapshot = await imageRef.put(imageFile);
  const jsonSnapshot = await jsonRef.put(jsonFile);

  const imageUrl = await imageSnapshot.ref.getDownloadURL();
  const jsonUrl = await jsonSnapshot.ref.getDownloadURL();

  await db.collection("mods").add({ name, author, imageUrl, jsonUrl });
  location.reload();
}

async function loadMods() {
  const container = document.getElementById("workshopList");
  const snapshot = await db.collection("mods").get();
  snapshot.forEach(doc => {
    const mod = doc.data();
    const modBox = document.createElement("div");
    modBox.className = "mod-box";

    const imageDiv = document.createElement("div");
    imageDiv.className = "mod-image";
    imageDiv.style.backgroundImage = `url(${mod.imageUrl})`;

    const infoDiv = document.createElement("div");
    infoDiv.className = "mod-info";
    infoDiv.innerHTML = `
      <div class="mod-title">${mod.name}</div>
      <div class="mod-author">Author: ${mod.author}</div>
      <button class="subscribe-btn" onclick="window.open('${mod.jsonUrl}', '_blank')">Subscribe</button>
    `;

    modBox.appendChild(imageDiv);
    modBox.appendChild(infoDiv);
    container.appendChild(modBox);
  });
}

loadMods();
</script>
</body>
</html>
