<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>LMod Workshop</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #111;
      color: #fff;
      margin: 0;
      padding: 0;
    }

    header {
      background: #222;
      padding: 20px;
      text-align: center;
    }

    header h1 {
      margin: 0;
      font-size: 36px;
    }

    #uploadForm {
      background: #1c1c1c;
      padding: 20px;
      text-align: center;
    }

    #uploadForm input, #uploadForm label {
      margin: 10px;
      display: block;
      font-size: 16px;
    }

    #uploadForm input[type="text"] {
      padding: 5px;
      width: 300px;
    }

    .workshop-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      padding: 20px;
      gap: 20px;
    }

    .mod-box {
      background: #222;
      border: 1px solid #444;
      border-radius: 10px;
      width: 400px;
      box-shadow: 0 0 10px #000;
      overflow: hidden;
    }

    .mod-image {
      width: 100%;
      height: 200px;
      background-size: cover;
      background-position: center;
      border-bottom: 1px solid #444;
    }

    .mod-info {
      padding: 15px;
    }

    .mod-title {
      font-size: 20px;
      margin-bottom: 5px;
    }

    .mod-author {
      font-size: 14px;
      color: #aaa;
      margin-bottom: 10px;
    }

    .subscribe-btn {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 5px;
      cursor: pointer;
    }

    .subscribe-btn:hover {
      background: #45a049;
    }
  </style>
</head>
<body>

<header>
  <h1>LMod Workshop</h1>
  <p>Upload and browse custom content for LMod</p>
</header>

<!-- Upload form -->
<div id="uploadForm">
  <h2>Upload a Mod</h2>
  <label>Mod Name: <input type="text" id="modName"></label>
  <label>Author: <input type="text" id="modAuthor" value="LEMONTECH"></label>
  <label>.json File: <input type="file" id="modFile" accept=".json"></label>
  <label>Preview Image (.png): <input type="file" id="modImage" accept="image/png"></label>
  <button onclick="uploadMod()">Add to Workshop</button>
</div>

<!-- Workshop section -->
<div class="workshop-container" id="workshopList"></div>

<script>
let mods = [];

function saveMods() {
  localStorage.setItem("lmodMods", JSON.stringify(mods));
}

function loadMods() {
  const saved = localStorage.getItem("lmodMods");
  if (saved) {
    mods = JSON.parse(saved);
    mods.forEach(renderMod);
  }
}

function uploadMod() {
  const name = document.getElementById("modName").value;
  const author = document.getElementById("modAuthor").value;
  const jsonFile = document.getElementById("modFile").files[0];
  const imageFile = document.getElementById("modImage").files[0];

  if (!name || !author || !jsonFile || !imageFile) {
    alert("Please fill in all fields and select files.");
    return;
  }

  const readerImg = new FileReader();
  const readerJSON = new FileReader();

  readerImg.onload = function(e) {
    const imageUrl = e.target.result;

    readerJSON.onload = function(ev) {
      const jsonData = ev.target.result;

      const modData = {
        name,
        author,
        imageUrl,
        jsonContent: jsonData,
        jsonFileName: jsonFile.name
      };

      mods.push(modData);
      saveMods();
      renderMod(modData);
    };

    readerJSON.readAsText(jsonFile);
  };

  readerImg.readAsDataURL(imageFile);
}

function renderMod(mod) {
  const container = document.getElementById("workshopList");

  const modBox = document.createElement("div");
  modBox.className = "mod-box";

  const imageDiv = document.createElement("div");
  imageDiv.className = "mod-image";
  imageDiv.style.backgroundImage = `url(${mod.imageUrl})`;

  const infoDiv = document.createElement("div");
  infoDiv.className = "mod-info";

  const title = document.createElement("div");
  title.className = "mod-title";
  title.textContent = mod.name;

  const authorText = document.createElement("div");
  authorText.className = "mod-author";
  authorText.textContent = "Author: " + mod.author;

  const btn = document.createElement("button");
  btn.className = "subscribe-btn";
  btn.textContent = "Subscribe";
  btn.onclick = () => {
    const blob = new Blob([mod.jsonContent], { type: "application/json" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = mod.jsonFileName || "mod.json";
    a.click();
  };

  infoDiv.appendChild(title);
  infoDiv.appendChild(authorText);
  infoDiv.appendChild(btn);

  modBox.appendChild(imageDiv);
  modBox.appendChild(infoDiv);

  container.appendChild(modBox);
}

loadMods();
</script>

</body>
</html>
